<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Annotation</title>

	<link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

	<script src="./js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="./lib/app/models/annotation_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/app/models/annotation.rb">lib/app/models/annotation.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">ActiveRecord::Base</p>
				
			</div>
			

			<!-- Namespace Contents -->
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#M000053">::create_multiple</a></li>
					
					<li><a href="#M000047">::find_annotatable</a></li>
					
					<li><a href="#M000045">::find_annotatables_with_attribute_name_and_value</a></li>
					
					<li><a href="#M000046">::find_annotatables_with_attribute_names_and_values</a></li>
					
					<li><a href="#M000049">::find_source</a></li>
					
					<li><a href="#M000050">#attribute_name</a></li>
					
					<li><a href="#M000051">#attribute_name=</a></li>
					
					<li><a href="#M000056">#check_annotatable</a></li>
					
					<li><a href="#M000058">#check_duplicate</a></li>
					
					<li><a href="#M000059">#check_limit_per_source</a></li>
					
					<li><a href="#M000057">#check_source</a></li>
					
					<li><a href="#M000060">#check_value_restrictions</a></li>
					
					<li><a href="#M000055">#process_value_adjustments</a></li>
					
					<li><a href="#M000054">#set_default_value_type</a></li>
					
					<li><a href="#M000052">#value=</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
			<div id="includes-section" class="section">
				<h3 class="section-header">Included Modules</h3>
				<ul class="link-list">
				
				
					<li><a class="include" href="AnnotationsVersionFu/ClassMethods.html">AnnotationsVersionFu::ClassMethods</a></li>
				
				
				</ul>
			</div>
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="./AUTHORS_rdoc.html">AUTHORS.rdoc</a></li>
				
					<li class="file"><a href="./CHANGELOG_rdoc.html">CHANGELOG.rdoc</a></li>
				
					<li class="file"><a href="./INDEX_rdoc.html">INDEX.rdoc</a></li>
				
					<li class="file"><a href="./LICENSE.html">LICENSE</a></li>
				
					<li class="file"><a href="./README_rdoc.html">README.rdoc</a></li>
				
					<li class="file"><a href="./RUNNING_TESTS_rdoc.html">RUNNING_TESTS.rdoc</a></li>
				
					<li class="file"><a href="./RakeFile.html">RakeFile</a></li>
				
					<li class="file"><a href="./TODO_rdoc.html">TODO.rdoc</a></li>
				
					<li class="file"><a href="./VERSION_yml.html">VERSION.yml</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="./Annotations/Acts/Annotatable/ClassMethods.html">Annotations::Acts::Annotatable::ClassMethods</a></li>
				
					<li><a href="./Annotations/Acts/Annotatable/InstanceMethods.html">Annotations::Acts::Annotatable::InstanceMethods</a></li>
				
					<li><a href="./Annotations/Acts/Annotatable/SingletonMethods.html">Annotations::Acts::Annotatable::SingletonMethods</a></li>
				
					<li><a href="./Annotations/Acts/AnnotationSource/ClassMethods.html">Annotations::Acts::AnnotationSource::ClassMethods</a></li>
				
					<li><a href="./Annotations/Acts/AnnotationSource/InstanceMethods.html">Annotations::Acts::AnnotationSource::InstanceMethods</a></li>
				
					<li><a href="./Annotations/Acts/AnnotationSource/SingletonMethods.html">Annotations::Acts::AnnotationSource::SingletonMethods</a></li>
				
					<li><a href="./Annotations/Config.html">Annotations::Config</a></li>
				
					<li><a href="./AnnotationsVersionFu.html">AnnotationsVersionFu</a></li>
				
					<li><a href="./AnnotationsVersionFu/ClassMethods.html">AnnotationsVersionFu::ClassMethods</a></li>
				
					<li><a href="./AnnotationsVersionFu/InstanceMethods.html">AnnotationsVersionFu::InstanceMethods</a></li>
				
					<li><a href="./Annotation.html">Annotation</a></li>
				
					<li><a href="./AnnotationAttribute.html">AnnotationAttribute</a></li>
				
					<li><a href="./AnnotationValueSeed.html">AnnotationValueSeed</a></li>
				
					<li><a href="./AnnotationsController.html">AnnotationsController</a></li>
				
					<li><a href="./AnnotationsMigrationGenerator.html">AnnotationsMigrationGenerator</a></li>
				
					<li><a href="./AnnotationsMigrationV1.html">AnnotationsMigrationV1</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Annotation</h1>

		<div id="description">
			
		</div>

		<!-- Constants -->
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="create-multiple-method" class="method-detail ">
				<a name="M000053"></a>

				<div class="method-heading">
				
					<span class="method-name">create_multiple</span><span
						class="method-args">(params, separator)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="create-multiple-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 154</span>
154:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">create_multiple</span>(<span class="ruby-identifier">params</span>, <span class="ruby-identifier">separator</span>)
155:     <span class="ruby-identifier">success</span> = <span class="ruby-keyword kw">true</span>
156:     <span class="ruby-identifier">annotations</span> = [ ]
157:     <span class="ruby-identifier">errors</span> = [ ]
158:     
159:     <span class="ruby-identifier">annotatable</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find_annotatable</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:annotatable_type</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:annotatable_id</span>])
160:     
161:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">annotatable</span>
162:       <span class="ruby-identifier">values</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:value</span>]
163:       
164:       <span class="ruby-comment cmt"># Remove value from params hash</span>
165:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;value&quot;</span>)
166:       
167:       <span class="ruby-identifier">values</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">separator</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
168:         <span class="ruby-identifier">ann</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>)
169:         <span class="ruby-identifier">ann</span>.<span class="ruby-identifier">value</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">strip</span>
170:         
171:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ann</span>.<span class="ruby-identifier">save</span>
172:           <span class="ruby-identifier">annotations</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ann</span>
173:         <span class="ruby-keyword kw">else</span>
174:           <span class="ruby-identifier">error_text</span> = <span class="ruby-node">&quot;Error(s) occurred whilst saving annotation with attribute: '#{params[:attribute_name]}', and value: #{val} - #{ann.errors.full_messages.to_sentence}.&quot;</span> 
175:           <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">error_text</span>
176:           <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-identifier">error_text</span>)
177:           <span class="ruby-identifier">success</span> = <span class="ruby-keyword kw">false</span>
178:         <span class="ruby-keyword kw">end</span>
179:       <span class="ruby-keyword kw">end</span>
180:     <span class="ruby-keyword kw">else</span>
181:       <span class="ruby-identifier">errors</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;Annotatable object doesn't exist&quot;</span>
182:       <span class="ruby-identifier">success</span> = <span class="ruby-keyword kw">false</span>
183:     <span class="ruby-keyword kw">end</span>
184:      
185:     <span class="ruby-keyword kw">return</span> [ <span class="ruby-identifier">success</span>, <span class="ruby-identifier">annotations</span>, <span class="ruby-identifier">errors</span> ]
186:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="find-annotatable-method" class="method-detail ">
				<a name="M000047"></a>

				<div class="method-heading">
				
					<span class="method-name">find_annotatable</span><span
						class="method-args">(annotatable_type, annotatable_id)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Helper class method to look up an annotatable object given the annotatable
class name and ID.
</p>
					

					
					<div class="method-source-code"
						id="find-annotatable-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 121</span>
121:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_annotatable</span>(<span class="ruby-identifier">annotatable_type</span>, <span class="ruby-identifier">annotatable_id</span>)
122:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">annotatable_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">annotatable_id</span>.<span class="ruby-identifier">nil?</span>
123:     <span class="ruby-keyword kw">begin</span>
124:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">annotatable_type</span>.<span class="ruby-identifier">constantize</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">annotatable_id</span>)
125:     <span class="ruby-keyword kw">rescue</span>
126:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
127:     <span class="ruby-keyword kw">end</span>
128:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="find-annotatables-with-attribute-name-and-value-method" class="method-detail ">
				<a name="M000045"></a>

				<div class="method-heading">
				
					<span class="method-name">find_annotatables_with_attribute_name_and_value</span><span
						class="method-args">(attribute_name, value)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns all the annotatable objects that have a specified attribute name
and value.
</p>
<p>
NOTE (1): both the attribute name and the value will be treated case
insensitively.
</p>
					

					
					<div class="method-source-code"
						id="find-annotatables-with-attribute-name-and-value-source">
<pre>
    <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 67</span>
67:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_annotatables_with_attribute_name_and_value</span>(<span class="ruby-identifier">attribute_name</span>, <span class="ruby-identifier">value</span>)
68:     <span class="ruby-keyword kw">return</span> [ ] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
69:     
70:     <span class="ruby-identifier">anns</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
71:                            <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:attribute</span>,
72:                            <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:annotation_attributes</span> =<span class="ruby-operator">&gt;</span>  { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span> }, 
73:                                             <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">downcase</span> })
74:                                                   
75:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">anns</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">annotatable</span>}
76:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="find-annotatables-with-attribute-names-and-values-method" class="method-detail ">
				<a name="M000046"></a>

				<div class="method-heading">
				
					<span class="method-name">find_annotatables_with_attribute_names_and_values</span><span
						class="method-args">(attribute_names, values)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Same as the <a
href="Annotation.html#M000045">Annotation.find_annotatables_with_attribute_name_and_value</a>
method but takes in arrays for attribute names and values.
</p>
<p>
This allows you to build any combination of attribute names and values to
search on. E.g. (1): <a
href="Annotation.html#M000046">Annotation.find_annotatables_with_attribute_names_and_values</a>([
&#8220;tag&#8221; ], [ &#8220;fiction&#8221;, &#8220;sci-fi&#8221;,
&#8220;fantasy&#8221; ]) E.g. (2): <a
href="Annotation.html#M000046">Annotation.find_annotatables_with_attribute_names_and_values</a>([
&#8220;tag&#8221;, &#8220;keyword&#8221;, &#8220;category&#8221; ], [
&#8220;fiction&#8221;, &#8220;fantasy&#8221; ])
</p>
<p>
NOTE (1): the arguments to this method MUST be Arrays of Strings. NOTE (2):
all attribute names and the values will be treated case insensitively.
</p>
					

					
					<div class="method-source-code"
						id="find-annotatables-with-attribute-names-and-values-source">
<pre>
    <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 87</span>
87:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_annotatables_with_attribute_names_and_values</span>(<span class="ruby-identifier">attribute_names</span>, <span class="ruby-identifier">values</span>)
88:     <span class="ruby-keyword kw">return</span> [ ] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attribute_names</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">blank?</span>
89:     
90:     <span class="ruby-identifier">anns</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
91:                            <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:attribute</span>,
92:                            <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:annotation_attributes</span> =<span class="ruby-operator">&gt;</span>  { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attribute_names</span> }, 
93:                                             <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">values</span> })
94:     
95:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">anns</span>.<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">annotatable</span>}
96:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="find-source-method" class="method-detail ">
				<a name="M000049"></a>

				<div class="method-heading">
				
					<span class="method-name">find_source</span><span
						class="method-args">(source_type, source_id)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Helper class method to look up a source object given the source class name
and ID.
</p>
					

					
					<div class="method-source-code"
						id="find-source-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 132</span>
132:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">find_source</span>(<span class="ruby-identifier">source_type</span>, <span class="ruby-identifier">source_id</span>)
133:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source_type</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">source_id</span>.<span class="ruby-identifier">nil?</span>
134:     <span class="ruby-keyword kw">begin</span>
135:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">source_type</span>.<span class="ruby-identifier">constantize</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">source_id</span>)
136:     <span class="ruby-keyword kw">rescue</span>
137:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
138:     <span class="ruby-keyword kw">end</span>
139:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
		</div>
	
		<div id="public-instance-method-details" class="method-section section">
			<h3 class="section-header">Public Instance Methods</h3>

		
			<div id="attribute-name-method" class="method-detail ">
				<a name="M000050"></a>

				<div class="method-heading">
				
					<span class="method-name">attribute_name</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="attribute-name-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 141</span>
141:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attribute_name</span>
142:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute</span>.<span class="ruby-identifier">name</span>
143:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="attribute-name--method" class="method-detail ">
				<a name="M000051"></a>

				<div class="method-heading">
				
					<span class="method-name">attribute_name=</span><span
						class="method-args">(attr_name)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="attribute-name--source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 145</span>
145:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attribute_name=</span>(<span class="ruby-identifier">attr_name</span>)
146:     <span class="ruby-identifier">attr_name</span> = <span class="ruby-identifier">attr_name</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
147:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute</span> = <span class="ruby-constant">AnnotationAttribute</span>.<span class="ruby-identifier">find_or_create_by_name</span>(<span class="ruby-identifier">attr_name</span>)
148:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="value--method" class="method-detail ">
				<a name="M000052"></a>

				<div class="method-heading">
				
					<span class="method-name">value=</span><span
						class="method-args">(value_in)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="value--source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 150</span>
150:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">value=</span>(<span class="ruby-identifier">value_in</span>)
151:     <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">:value</span>] = <span class="ruby-identifier">value_in</span>.<span class="ruby-identifier">to_s</span>
152:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
		</div>
	
		<div id="protected-instance-method-details" class="method-section section">
			<h3 class="section-header">Protected Instance Methods</h3>

		
			<div id="check-annotatable-method" class="method-detail ">
				<a name="M000056"></a>

				<div class="method-heading">
				
					<span class="method-name">check_annotatable</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<h6>=====</h6>
<p>
Validations
</p>
<hr size="9"></hr>
					

					
					<div class="method-source-code"
						id="check-annotatable-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_annotatable</span>
219:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find_annotatable</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_type</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_id</span>).<span class="ruby-identifier">nil?</span>
220:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">:annotatable_id</span>, <span class="ruby-value str">&quot;doesn't exist&quot;</span>)
221:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
222:     <span class="ruby-keyword kw">else</span>
223:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
224:     <span class="ruby-keyword kw">end</span>
225:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="check-duplicate-method" class="method-detail ">
				<a name="M000058"></a>

				<div class="method-heading">
				
					<span class="method-name">check_duplicate</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
This method checks whether duplicates are allowed for this particular
annotation type (ie: for the attribute that this annotation belongs to). If
not, it checks for a duplicate existing annotation.
</p>
					

					
					<div class="method-source-code"
						id="check-duplicate-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 238</span>
238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_duplicate</span>
239:     <span class="ruby-identifier">attr_name</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">downcase</span>
240:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span>.<span class="ruby-identifier">attribute_names_to_allow_duplicates</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">attr_name</span>)
241:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
242:     <span class="ruby-keyword kw">else</span>
243:       <span class="ruby-identifier">existing</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
244:                                  <span class="ruby-identifier">:joins</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-identifier">:attribute</span> ],
245:                                  <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:annotatable_type</span> =<span class="ruby-operator">&gt;</span>  <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_type</span>, 
246:                                                   <span class="ruby-identifier">:annotatable_id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_id</span>, 
247:                                                   <span class="ruby-identifier">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>,
248:                                                   <span class="ruby-identifier">:annotation_attributes</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">attr_name</span>  } })
249:       
250:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">existing</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">existing</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">id</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>
251:         <span class="ruby-comment cmt"># It's all good...</span>
252:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
253:       <span class="ruby-keyword kw">else</span>
254:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>(<span class="ruby-value str">&quot;This annotation already exists and is not allowed to be created again.&quot;</span>)
255:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
256:       <span class="ruby-keyword kw">end</span>
257:     <span class="ruby-keyword kw">end</span>
258:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="check-limit-per-source-method" class="method-detail ">
				<a name="M000059"></a>

				<div class="method-heading">
				
					<span class="method-name">check_limit_per_source</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
This method uses the &#8216;limits_per_source config&#8217; setting to
check whether a limit has been reached.
</p>
<p>
NOTE: this check is only carried out on new records, not records that are
being updated.
</p>
					

					
					<div class="method-source-code"
						id="check-limit-per-source-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 263</span>
263:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_limit_per_source</span>
264:     <span class="ruby-identifier">attr_name</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">downcase</span>
265:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">new_record?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">limits_per_source</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">attr_name</span>)
266:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">limits_per_source</span>[<span class="ruby-identifier">attr_name</span>]
267:       <span class="ruby-identifier">max</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">0</span>]
268:       <span class="ruby-identifier">can_replace</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">1</span>]
269:       
270:       <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">found_annotatable</span> = <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find_annotatable</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_type</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">annotatable_id</span>)).<span class="ruby-identifier">nil?</span>
271:         <span class="ruby-identifier">anns</span> = <span class="ruby-identifier">found_annotatable</span>.<span class="ruby-identifier">annotations_with_attribute_and_by_source</span>(<span class="ruby-identifier">attr_name</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">source</span>)
272:         
273:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">anns</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">max</span>
274:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>(<span class="ruby-value str">&quot;The limit has been reached for annotations with this attribute and by this source.&quot;</span>)
275:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
276:         <span class="ruby-keyword kw">else</span>
277:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
278:         <span class="ruby-keyword kw">end</span>
279:       <span class="ruby-keyword kw">else</span>
280:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
281:       <span class="ruby-keyword kw">end</span>
282:     <span class="ruby-keyword kw">else</span>
283:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
284:     <span class="ruby-keyword kw">end</span>
285:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="check-source-method" class="method-detail ">
				<a name="M000057"></a>

				<div class="method-heading">
				
					<span class="method-name">check_source</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="check-source-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 227</span>
227:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_source</span>
228:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotation</span>.<span class="ruby-identifier">find_source</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">source_type</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">source_id</span>).<span class="ruby-identifier">nil?</span>
229:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">:source_id</span>, <span class="ruby-value str">&quot;doesn't exist&quot;</span>)
230:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
231:     <span class="ruby-keyword kw">else</span>
232:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
233:     <span class="ruby-keyword kw">end</span>
234:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="check-value-restrictions-method" class="method-detail ">
				<a name="M000060"></a>

				<div class="method-heading">
				
					<span class="method-name">check_value_restrictions</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="check-value-restrictions-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 287</span>
287:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_value_restrictions</span>
288:     <span class="ruby-identifier">attr_name</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">downcase</span>
289:     <span class="ruby-identifier">value_to_check</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">downcase</span>
290:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">value_restrictions</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">attr_name</span>)
291:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">value_restrictions</span>[<span class="ruby-identifier">attr_name</span>]
292:       
293:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:in</span>]
294:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
295:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:in</span>].<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">downcase</span>}.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">value_to_check</span>)
296:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
297:           <span class="ruby-keyword kw">else</span>
298:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:error_message</span>])
299:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
300:           <span class="ruby-keyword kw">end</span>
301:           
302:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Range</span>
303:           <span class="ruby-comment cmt"># Need to take into account that &quot;a_string&quot;.to_i == 0</span>
304:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value_to_check</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0&quot;</span>
305:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:in</span>] <span class="ruby-operator">===</span> <span class="ruby-value">0</span>
306:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
307:             <span class="ruby-keyword kw">else</span>
308:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:error_message</span>])
309:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
310:             <span class="ruby-keyword kw">end</span>
311:           <span class="ruby-keyword kw">else</span>
312:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:in</span>] <span class="ruby-operator">===</span> <span class="ruby-identifier">value_to_check</span>.<span class="ruby-identifier">to_i</span>
313:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
314:             <span class="ruby-keyword kw">else</span>
315:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">add_to_base</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:error_message</span>])
316:               <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
317:             <span class="ruby-keyword kw">end</span>
318:           <span class="ruby-keyword kw">end</span>
319:           
320:         <span class="ruby-keyword kw">else</span>
321:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
322:       <span class="ruby-keyword kw">end</span>
323:     <span class="ruby-keyword kw">else</span>
324:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
325:     <span class="ruby-keyword kw">end</span>      
326:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="process-value-adjustments-method" class="method-detail ">
				<a name="M000055"></a>

				<div class="method-heading">
				
					<span class="method-name">process_value_adjustments</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="process-value-adjustments-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 194</span>
194:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_value_adjustments</span>
195:     <span class="ruby-identifier">attr_name</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute_name</span>.<span class="ruby-identifier">downcase</span>
196:     <span class="ruby-comment cmt"># Make lowercase or uppercase if required</span>
197:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">downcase!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">attribute_names_for_values_to_be_downcased</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">attr_name</span>)
198:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">upcase!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">attribute_names_for_values_to_be_upcased</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">attr_name</span>)
199:     
200:     <span class="ruby-comment cmt"># Apply strip text rules</span>
201:     <span class="ruby-constant">Annotations</span><span class="ruby-operator">::</span><span class="ruby-constant">Config</span><span class="ruby-operator">::</span><span class="ruby-identifier">strip_text_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span>, <span class="ruby-identifier">strip_rules</span><span class="ruby-operator">|</span>
202:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">attr_name</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">downcase</span>
203:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">strip_rules</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Array</span>
204:           <span class="ruby-identifier">strip_rules</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
205:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">s</span>, <span class="ruby-value str">''</span>)
206:           <span class="ruby-keyword kw">end</span>
207:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">strip_rules</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">strip_rules</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Regexp</span>
208:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">strip_rules</span>, <span class="ruby-value str">''</span>)
209:         <span class="ruby-keyword kw">end</span>
210:       <span class="ruby-keyword kw">end</span>
211:     <span class="ruby-keyword kw">end</span>
212:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
			<div id="set-default-value-type-method" class="method-detail ">
				<a name="M000054"></a>

				<div class="method-heading">
				
					<span class="method-name">set_default_value_type</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p class="missing-docs">(Not documented)</p>
					

					
					<div class="method-source-code"
						id="set-default-value-type-source">
<pre>
     <span class="ruby-comment cmt"># File lib/app/models/annotation.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_default_value_type</span>
191:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value_type</span> = <span class="ruby-value str">&quot;String&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">value_type</span>.<span class="ruby-identifier">blank?</span>
192:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

