<% truncate_length_for_boxes = 22 -%>
<%#= stylesheet_link_tag "scrolltable" %>
<%= javascript_include_tag 'toggler.js' %>
<%= stylesheet_link_tag 'survey_ul'%>
<%= stylesheet_link_tag 'faux_table'%>

<ul class="sectionIcons">

<%# if Authorization.is_authorized?("download", nil, @survey, current_user) -%>
<%#*always show edit button, the controller will flash a message if not available%>
  <% if !@archive.failure && Authorization.is_authorized?("download", nil, @archive, current_user) -%>
    <li><%= icon('download', download_csvarchive_url, "Download CSV file", nil, "Download CSV file") -%></li>
  <% end -%>
<%# elsif @archive.failure %>
<%# if Authorization.is_authorized?("download", nil, @archive, current_user) -%>
<%#= button_to_remote "Recreate CSV archive", :url => {:controller=>"csvarchives",:action => "recreate", :id => @archive.id} %>
<%# end %>
<%# else %>
  <% if Authorization.is_authorized?("edit", nil, @archive, current_user) -%>
    <li><%= icon "edit", edit_csvarchive_path(@archive), nil, nil, "Edit" -%></li>
  <% end %>
</ul>

<h1 class="contribution_title">CSV Archive: <%= link_to(h(@archive.title), csvarchive_path(@archive)) -%></h1>



<div class="show_basic">
<%#*<div class="main_content_left_box">%>
  <div class="box_about_actor">
    <p>
      <b>Title:</b>
      <% unless @archive.title.blank? -%>
        <span class="title"><%=h @archive.title -%></span>
      <% else -%>
      <p class="none_text">
        No title
      </p>
    <% end -%>
    </p>


    <br/>

    <p>
      <b>Description</b>
      <% unless @archive.description.blank? -%>
      <div class="box_standout" style="background-color:#FFFFFF;">
        <%= simple_format(white_list(@archive.description)) -%>
      </div>
    <% else -%>
      <p class="none_text">
        No description
      </p>
    <% end -%>
    <br/>
    <b>Linked with Script(s):</b>
    <% if !@scripts.empty? -%>

      <% @scripts.each do |script| -%>
        <%= link_to(script.title, script_path(script)) -%>
      <% end -%>
    <% else -%>
      None
    <% end -%>
    <br/>
        <b>Linked with Survey(s):</b>
    <% if !@surveys.empty? -%>

      <% @surveys.each do |survey| -%>
        <%= link_to(survey.title, survey_path(survey)) -%>
      <% end -%>
    <% else -%>
      None
    <% end -%>
    <br/>
    <br/>
    <b>Status:</b>
    <% if @archive.complete && !@archive.failure%>
      <span class="title"><%=h "ready for download" -%></span>
  <%# elsif @archive.failure-%>
  <%#*<span class="title" style="color:red;">%>
  <%#=h "Not available due to errors - please recreate" -%>
  <%#*</span>%>
    <% elsif @archive.failure -%>
      <span class="title" style="color:red;"><%=h "Failed: please re-create" -%></span>
    <% else -%>
      <span class="title"><%=h "Unknown: click on the download button to check" -%></span>
    <% end -%>
    </p>
    <%= render :partial => "datetime_info", :locals => { :resource => @archive } -%>
<%#*</div>%>
  </div>
  <% form_remote_tag :url => { :action => "add_to_cart"} do -%>

    <br/>
    <table style="background-color:#ACCBE0;width:100%;padding-bottom:5px;
           padding-left:5px;
           padding-top:5px;">
      <tr><td style="text-align:left;"><%= submit_tag 'Add selected variables to cart'%></td></tr>
      <tr><td style="text-align:left;"> Select:
          <%= link_to_function 'All', "$$('input.variable_checkbox').each(function(checkbox) { checkbox.checked = true; });" %>
          ,&nbsp
          <%= link_to_function 'None', "$$('input.variable_checkbox').each(function(checkbox) { checkbox.checked = false; });" %>
          ,&nbsp
          <%= link_to_function 'Invert selection', "$$('input.variable_checkbox').each(function(checkbox) { if (checkbox.checked == true) {checkbox.checked = false;} else {checkbox.checked = true; } });" %>

        </td></tr>
    </table>
    <br/>
    <div id="table_header" class="faux_table_header_container">
      <%= render :partial => "surveys/table_header",:locals=>{:sorted_variables => @sorted_variables} -%>
    </div>
    <div id="table_container" class="faux_table_container">
      <%= render :partial => "surveys/table",:locals=>{:sorted_variables => @sorted_variables} -%>

    </div>
    <br/>

  <% end %>

</div>
