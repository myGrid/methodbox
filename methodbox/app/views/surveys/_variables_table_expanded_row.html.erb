<%= javascript_include_tag 'toggler.js' %>

<div id= "<%= row_name + "_expanded" -%>" style="display: <%= hidden ? "none":"inline" -%>">
  <div>
	<% if item.is_archived? %>
    	<ul class="faux_table_archived">
	<% else %>
	   	<ul class="faux_table<%= curr_cycle %>">
	<% end %>
      <li>
		<% if item.is_archived? %>
		<div class="col1"><%= check_box_tag "variable_ids[]", item.id,false, :class=>'variable_checkbox',:disabled=>true,:id=>"#{row_name + '_expanded_checkbox'}" -%></div>
        <div class="col2"><%= image_tag("folds/fold.png", :title=>"Hide details...",:alt=>"Hide details...", :border => 0, :onclick=>"javascript: Element.hide($('#{row_name + '_expanded'}'));Element.show($('#{row_name}'));") -%></div>
		<% else %>
		<div class="col1"><%= check_box_tag "variable_ids[]", item.id,false, :class=>'variable_checkbox', :onclick => "setTrueOrFalse()",:id=>"#{row_name + '_expanded_checkbox'}" -%></div>
        <div class="col2"><%= image_tag("folds/fold.png", :title=>"Hide details...",:alt=>"Hide details...", :border => 0, :onclick=>"javascript:if ($('#{row_name + '_expanded_checkbox'}').checked == true) {$('#{row_name + '_checkbox'}').checked =true} else {$('#{row_name + '_checkbox'}').checked=false};Field.disable('#{row_name + '_expanded_checkbox'}');Field.enable('#{row_name + '_checkbox'}');Element.hide($('#{row_name + '_expanded'}'));Element.show($('#{row_name}'));") -%></div>
		<% end %>
	<% if item.is_archived? %>
	<% if item.name.size > 20 -%>
      <div class="col3"><%= link_to(item.hyphenName, variable_path(item), :title=>item.name) -%>(Archived)</div>
    <% else -%>
      <div class="col3"><%= link_to(item.name, variable_path(item)) -%>(Archived)</div>
    <% end -%>
	<% else %>
	<% if item.name.size > 20 -%>
      <div class="col3"><%= link_to(item.hyphenName, variable_path(item), :title=>item.name) -%></div>
    <% else -%>
      <div class="col3"><%= link_to(item.name, variable_path(item)) -%></div>
    <% end -%>
	<% end %>
 
        <div class="col4">
          <% if item.value != nil -%>
            <%= item.value -%>
          <% else -%>
            <%= "NO DESCRIPTION" -%>
          <% end -%>
        </div>
        <div class="col5">
          <% if item.category != nil -%>
            <%= link_to(item.category, by_category_variables_url(:category=>item.category),:title=>"Show all variables with this category") -%>
          <% else -%>
            <%= "NO CATEGORY" -%>
          <%  end -%>
        </div>
        <div class="col6"><%= dataset.survey.survey_type.shortname -%></div>
        <div class="col7"><%= link_to dataset.name, dataset_url(dataset) -%></div>
        <div class="col8"><%= dataset.survey.year -%> </div>
	 <div class="col9">
        <%= popularity -%>
      </div>
</li>
    </ul>
  </div>
  <% if item.name.size > 20 -%>
    <div style="width:875px;margin:auto;">Actual Variable name: <%= item.name -%></div>
    <br/>
  <% end -%>
  <div>
    <% unless item.document.blank? -%>
      <div style="width:875px;margin:auto;">Document: 
        <%= link_to(item.document + ", page " + item.page, open_pdf_variable_url(item) + "#page=" + item.page,:title=>"Open the PDF document with information about this variable") -%>
      </div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No documentation listed</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% if item.category != nil -%>
      <div style="width:875px;margin:auto;">Category: <%= item.category -%></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No category recorded for this variable</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% unless item.dertype.blank? -%>
      <div style="width:875px;margin:auto;">Variable source: <%= item.dertype %></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No source</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% unless item.dermethod.blank? -%>
      <div style="width:875px;margin:auto;">Derivation method:</div>
      <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"><pre><%=  item.dermethod -%></pre></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No derivation method recorded for this variable</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% if item.info != nil -%>
      <div style="width:875px;margin:auto;">Allowed values:</div>
      <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"><pre><%= item.info -%></pre></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No value information recorded for this variable</div>
    <% end -%>
  </div>
  <!-- <%= item.name %> -->
  <%= render :partial => "variables/statistics_table",:locals=>{:variable => item} %> 
  <!-- <div> -->
    <%# if !item.variable_links.empty? -%>
      <!-- <div style="width:875px;margin:auto;">Grouped with:</div> -->
      <!-- <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"> -->
        <%# item.variable_links.each do |link| -%>
          <%# link.variables.each do |var| -%>
            <%# if item.id != var.id -%>
              <%#= link_to(var.name, variable_path(var))-%>
            <%# end -%>
          <%# end -%>
        <%# end -%>
      <!-- </div> -->
    <%# else -%>
      <!-- <div style="width:875px;margin:auto;color:red;">No groupings recorded for this variable</div> -->
    <%# end -%>
  <!-- </div> -->
  <!-- <br/> -->
<%#*<div style="width:680px;margin:auto;">%>
<%# unless item.title_counts.empty? %>
<%#*<b>Tags: </b>%>


<%#*<b>|</b>%>
<%# item.title_counts.each do |tag| %>
<%#= link_to tag.name, variables_url(:variable=>tag.name), :title=>"Search for other variables with tag " + tag.name -%>
<%#*<b>|</b>%>
<%# end -%>



<%# else %>
<%#*<b>Tags: </b>none%>
<%# end %>
<%#*</div>%>
  <br/>
<%#*<div style="width:680px;margin:auto;">%>
<%# if !Person.find(current_user.person_id).watched_variables.any?{|var| var.variable_id == item.id} %>
<%#= image_submit_tag('famfamfam_silk/camera_add.png', :alt=> 'Watch variable', :title=>'Watch variable', :onclick=>"Form.getInputs(this.form, null,'variable_identifier')[0].value = '#{item.id.to_s}';Form.getInputs(this.form, null,'watch_variable')[0].value = 'true';Form.getInputs(this.form, null,'year_of_survey')[0].value = 'survey_year'") -%>
<%# else %>
<%#= image_submit_tag('famfamfam_silk/camera_delete.png', :alt=> 'Stop watching variable', :title=>'Stop watching variable', :onclick=>"Form.getInputs(this.form, null,'variable_identifier')[0].value = '#{item.id.to_s}';Form.getInputs(this.form, null,'watch_variable')[0].value = 'delete';Form.getInputs(this.form, null,'year_of_survey')[0].value = 'survey_year'") -%>
<%#*<i> You are watching this variable</i>%>
<%#*</div>%>

<%# end %>

</div>
