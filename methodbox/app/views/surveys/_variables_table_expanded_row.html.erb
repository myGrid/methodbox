<%= javascript_include_tag 'toggler.js' %>

<div id= "<%=item.name + item.dataset_id.to_s + "_expanded" -%>" style="display: <%= hidden ? "none":"inline" -%>">
  <div>
    <ul class="faux_table<%= curr_cycle %>">
      <li>
        <div class="col1"><%= check_box_tag "variable_ids[]", item.id,false, :class=>'variable_checkbox', :onclick => "setTrueOrFalse()",:id=>"#{item.name + item.dataset_id.to_s + '_expanded_checkbox'}" -%></div>
        <div class="col2"><%= image_tag("folds/fold.png", :title=>"Hide details...",:alt=>"Hide details...", :border => 0, :onclick=>"javascript:if ($('#{item.name + item.dataset_id.to_s + '_expanded_checkbox'}').checked == true) {$('#{item.name + item.dataset_id.to_s + '_checkbox'}').checked =true} else {$('#{item.name + item.dataset_id.to_s + '_checkbox'}').checked=false};Field.disable('#{item.name + item.dataset_id.to_s + '_expanded_checkbox'}');Field.enable('#{item.name + item.dataset_id.to_s + '_checkbox'}');Element.hide($('#{item.name + item.dataset_id.to_s + '_expanded'}'));Element.show($('#{item.name + item.dataset_id.to_s}'));") -%></div>
        <div class="col3"><%= link_to(item.name, variable_path(item)) -%></div>
        <div class="col4">
          <% if item.value != nil -%>
            <%= item.value -%>
          <% else -%>
            <%= "NO DESCRIPTION" -%>
          <% end -%>
        </div>
        <div class="col5">
          <% if item.category != nil -%>
            <%= link_to(item.category, by_category_variables_url(:category=>item.category),:title=>"Show all variables with this category") -%>
          <% else -%>
            <%= "NO CATEGORY" -%>
          <%  end -%>
        </div>
        <div class="col6"><%= Dataset.find(item.dataset_id).survey.surveytype -%></div>
        <div class="col7"><%= link_to Dataset.find(item.dataset_id).name, dataset_url(Dataset.find(item.dataset_id)) -%></div>
        <div class="col8"><%= Dataset.find(item.dataset_id).survey.year -%> </div>
	 <div class="col9">
        <%= VariableList.all(:conditions=>"variable_id=" + item.id.to_s).size -%>
      </div>
</li>
    </ul>
  </div>
  <div>
    <% if item.current_version >1 %>
      old_ver = item.current_version - 1
      old_var = Variable.find(:all,:conditions=> "dataset_id=" + item.dataset_id.to_s + " and name='" + item.name+"' and current_version=" + old_ver.to_s)
      <div style="width:875px;margin:auto;">Dataset update: 
        <% if old_var %>
          <%= link_to("previous version of this variable", variable_path(old_var[0]),:title=>"Previous version of this variable") -%>
        <% else %>
           There was no previous variable with this name
        <% end %>
      </div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">Original version</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% unless item.document.blank? -%>
      <div style="width:875px;margin:auto;">Document: 
        <%= link_to(item.document + ", page " + item.page, open_pdf_variable_url(item) + "#page=" + item.page,:title=>"Open the PDF document with information about this variable") -%>
      </div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No documentation listed</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% if item.category != nil -%>
      <div style="width:875px;margin:auto;">Category: <%= item.category -%></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No category recorded for this variable</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% unless item.dertype.blank? -%>
      <div style="width:875px;margin:auto;">Variable source: <%= item.dertype %></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No source</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% unless item.dermethod.blank? -%>
      <div style="width:875px;margin:auto;">Derivation method:</div>
      <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"><pre><%=  item.dermethod -%></pre></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No derivation method recorded for this variable</div>
    <% end -%>
  </div>
  <br/>
  <div>
    <% if item.info != nil -%>
      <div style="width:875px;margin:auto;">Allowed values:</div>
      <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"><pre><%= item.info -%></pre></div>
    <% else -%>
      <div style="width:875px;margin:auto;color:red;">No value information recorded for this variable</div>
    <% end -%>
  </div>
  <!-- <div> -->
    <%# if !item.variable_links.empty? -%>
      <!-- <div style="width:875px;margin:auto;">Grouped with:</div> -->
      <!-- <div style="width:875px;margin:auto;border:0.2em solid #ACCBE0;"> -->
        <%# item.variable_links.each do |link| -%>
          <%# link.variables.each do |var| -%>
            <%# if item.id != var.id -%>
              <%#= link_to(var.name, variable_path(var))-%>
            <%# end -%>
          <%# end -%>
        <%# end -%>
      <!-- </div> -->
    <%# else -%>
      <!-- <div style="width:875px;margin:auto;color:red;">No groupings recorded for this variable</div> -->
    <%# end -%>
  <!-- </div> -->
  <!-- <br/> -->
<%#*<div style="width:680px;margin:auto;">%>
<%# unless item.title_counts.empty? %>
<%#*<b>Tags: </b>%>


<%#*<b>|</b>%>
<%# item.title_counts.each do |tag| %>
<%#= link_to tag.name, variables_url(:variable=>tag.name), :title=>"Search for other variables with tag " + tag.name -%>
<%#*<b>|</b>%>
<%# end -%>



<%# else %>
<%#*<b>Tags: </b>none%>
<%# end %>
<%#*</div>%>
  <br/>
<%#*<div style="width:680px;margin:auto;">%>
<%# if !Person.find(current_user.person_id).watched_variables.any?{|var| var.variable_id == item.id} %>
<%#= image_submit_tag('famfamfam_silk/camera_add.png', :alt=> 'Watch variable', :title=>'Watch variable', :onclick=>"Form.getInputs(this.form, null,'variable_identifier')[0].value = '#{item.id.to_s}';Form.getInputs(this.form, null,'watch_variable')[0].value = 'true';Form.getInputs(this.form, null,'year_of_survey')[0].value = 'survey_year'") -%>
<%# else %>
<%#= image_submit_tag('famfamfam_silk/camera_delete.png', :alt=> 'Stop watching variable', :title=>'Stop watching variable', :onclick=>"Form.getInputs(this.form, null,'variable_identifier')[0].value = '#{item.id.to_s}';Form.getInputs(this.form, null,'watch_variable')[0].value = 'delete';Form.getInputs(this.form, null,'year_of_survey')[0].value = 'survey_year'") -%>
<%#*<i> You are watching this variable</i>%>
<%#*</div>%>

<%# end %>

</div>
